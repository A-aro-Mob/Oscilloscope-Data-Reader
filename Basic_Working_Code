#Oscilloscope Type: Siglent SDS 1104X-E 

#Imports
import pyvisa

#Resource Manager
rm = pyvisa.ResourceManager()
scope = rm.open_resource(rm.list_resources()[0])

# Commands to get data
scope.write(':STOP')
scope.write("WFSU SP,2,NP,500,FP,100")
scope.write('C1:WF? DAT2')
rawdata = scope.read_raw()

# Print raw data
print(rawdata)

import numpy as np

# Find the start of the binary block
start = rawdata.find(b'#')
header_len = int(rawdata[start+1:start+2])
data_len = int(rawdata[start+2:start+2+header_len])
data_start = start + 2 + header_len
data = rawdata[data_start:data_start + data_len]

# Convert to signed integers
wave = np.frombuffer(data, dtype=np.uint8).astype(np.int16)
wave[wave > 127] -= 255

# Query vertical scale and offset
vdiv = float(scope.query('C1:VDIV?').split()[1][:-1])
voffset = float(scope.query('C1:OFST?').split()[1][:-1])

# Convert to voltage values
voltages = wave * (vdiv / 25) - voffset

# Print first few voltage values
print("First 10 voltage values:", voltages[:10])
